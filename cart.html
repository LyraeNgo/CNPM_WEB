<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Gi·ªè h√†ng | GIANG-HIEUKY</title>
  <link rel="stylesheet" href="cart.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<style>
    body {
  font-family: Arial, sans-serif;
  margin: 0;
  background: #f5f5f5;
}

.navbar {
  background: #222;
  color: white;
  padding: 10px 20px;
  display: flex;
  justify-content: space-between;
}

.navbar a {
  color: white;
  margin-left: 15px;
  text-decoration: none;
}

.navbar a.active {
  font-weight: bold;
  text-decoration: underline;
}

.cart-container {
  max-width: 1000px;
  margin: 30px auto;
  background: white;
  padding: 20px;
  border-radius: 6px;
}

.cart-header, .cart-item {
  display: grid;
  grid-template-columns: 3fr 1fr 1fr 1fr 1fr;
  align-items: center;
  padding: 10px 0;
  border-bottom: 1px solid #ddd;
}

.product-info {
  display: flex;
  align-items: center;
  gap: 15px;
}

.product-info img {
  width: 60px;
  height: 60px;
  object-fit: cover;
}

.quantity {
  display: flex;
  align-items: center;
}

.quantity input {
  width: 40px;
  text-align: center;
}

.quantity button {
  width: 25px;
  height: 25px;
}

.remove-btn {
  background: transparent;
  color: red;
  border: none;
  cursor: pointer;
}

.cart-footer {
  display: flex;
  justify-content: space-between;
  margin-top: 20px;
}

.checkout {
  background: #f60;
  color: white;
  padding: 10px 20px;
  border: none;
  cursor: pointer;
}

</style>
<body>
  <header class="navbar">
    <div class="logo"><a href="index.html">üñ•Ô∏è GIANG-HIEUKY</a></div>
    <div class="nav-right">
      <a href="index.php">Trang ch·ªß</a>
      <a href="cart.html" class="active">Gi·ªè h√†ng</a>
    </div>
  </header>

  <section class="cart-container">
    <h1>üõí Gi·ªè h√†ng c·ªßa b·∫°n</h1>

    <div class="cart-header">
      <span>S·∫£n ph·∫©m</span>
      <span>ƒê∆°n gi√°</span>
      <span>S·ªë l∆∞·ª£ng</span>
      <span>Th√†nh ti·ªÅn</span>
      <span>Thao t√°c</span>
    </div>

    <form action="submit_order.html" method="POST" id="cartForm">
      <div class="cart-item">
        <div class="product-info">
          <input type="checkbox" name="productId[]" value="1">
          <img src="https://down-vn.img.susercontent.com/file/vn-11134207-7r98o-lm3vvfd87dzu6a" alt="">
          <div>
            <p>Laptop Asus VivoBook S14 S433EA-EK216T</p>
            <small>Ph√¢n lo·∫°i: <input type="text" name="category[]" value="Laptop" readonly></small>
            <input type="hidden" name="productName[]" value="Laptop Asus VivoBook S14 S433EA-EK216T">
            <input type="hidden" name="price[]" value="100000000">
          </div>
        </div>
        <div>‚Ç´100.000.000</div>
        <div class="quantity">
          <button type="button" onclick="changeQty(1, -1)">-</button>
          <input type="text" name="quantity[]" value="1" id="qty-1">
          <button type="button" onclick="changeQty(1, 1)">+</button>
        </div>
        <div class="subtotal">‚Ç´100.000.000</div>
        <div><button type="button" class="remove-btn" onclick="removeProduct(1)">X√≥a</button></div>
      </div>

      <div class="cart-item">
        <div class="product-info">
          <input type="checkbox" name="productId[]" value="2">
          <img src="https://down-vn.img.susercontent.com/file/vn-11134207-7r98o-lm3vvfd87dzu6a" alt="">
          <div>
            <p>Laptop Dell Inspiron 15 3000</p>
            <small>Ph√¢n lo·∫°i: <input type="text" name="category[]" value="Laptop" readonly></small>
            <input type="hidden" name="productName[]" value="Laptop Dell Inspiron 15 3000">
            <input type="hidden" name="price[]" value="150000000">
          </div>
        </div>
        <div>‚Ç´150.000.000</div>
        <div class="quantity">
          <button type="button" onclick="changeQty(2, -1)">-</button>
          <input type="text" name="quantity[]" value="1" id="qty-2">
          <button type="button" onclick="changeQty(2, 1)">+</button>
        </div>
        <div class="subtotal">‚Ç´150.000.000</div>
        <div><button type="button" class="remove-btn" onclick="removeProduct(2)">X√≥a</button></div>
      </div>

      <hr>
      <div class="cart-footer">
        <input type="hidden" name="customerId" value="1"> 
        <div class="right">
          <span>T·ªïng c·ªông: <strong class="total">‚Ç´0</strong></span>
          <button type="submit" class="checkout">Mua h√†ng</button>
        </div>
      </div>
    </form>
  </section>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>

  <script>
    function updateTotal() {
      let total = 0;
      document.querySelectorAll('input[name="productId[]"]:checked').forEach(function(checkbox) {
        let qty = parseInt(checkbox.closest('.cart-item').querySelector('input[name="quantity[]"]').value);
        let price = parseInt(checkbox.closest('.cart-item').querySelector('input[name="price[]"]').value);
        total += price * qty;
      });
      document.querySelector('.total').textContent = '‚Ç´' + total.toLocaleString();
    }
  
    function changeQty(productId, amount) {
      let qtyInput = document.getElementById('qty-' + productId);
      let currentQty = parseInt(qtyInput.value);
      if (!isNaN(currentQty)) {
        qtyInput.value = Math.max(1, currentQty + amount);
        updateSubtotal(productId);
      }
    }
  
    function updateSubtotal(productId) {
      let checkbox = document.querySelector('input[name="productId[]"][value="' + productId + '"]');
      let qty = parseInt(document.getElementById('qty-' + productId).value);
      let price = parseInt(checkbox.closest('.cart-item').querySelector('input[name="price[]"]').value);
      let subtotalElement = checkbox.closest('.cart-item').querySelector('.subtotal');
      subtotalElement.textContent = '‚Ç´' + (price * qty).toLocaleString();
      updateTotal();
    }
  
    function removeProduct(productId) {
      let checkbox = document.querySelector('input[name="productId[]"][value="' + productId + '"]');
      if (checkbox.checked) {
        checkbox.closest('.cart-item').remove();
        updateTotal();
      }
    }
  
    function generateQRCode() {
      const qrContainer = $('#qr-container');
      qrContainer.empty(); 
  
      const randomCode = "PAY_" + Math.random().toString(36).substring(2, 10).toUpperCase();
      const qrDiv = $('<div id="qrcode"></div>');
      qrContainer.append(qrDiv);
  
      new QRCode(document.getElementById("qrcode"), {
        text: randomCode,
        width: 128,
        height: 128
      });
    }
  
    $(document).ready(function () {
      $('input[name="paymentMethod"]').on('change', function () {
        $('#qr-container').empty();
        $('#e-wallet-container').empty();
        if (this.value === 'QR') {
          generateQRCode();
        }
        if (this.value === 'e-wallet') {
          generateBankCards();
        }
      });

      $('input[name="productId[]"]').on('change', function () {
        updateSubtotal(this.value);
        updateTotal();
      });

      $('form').on('submit', function (e) {
        e.preventDefault();
        const anyChecked = $('input[name="productId[]"]:checked').length > 0;
        if (!anyChecked) {
          alert('Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt s·∫£n ph·∫©m tr∆∞·ªõc khi mua h√†ng.');
          return;
        }

        // Get all selected products data
        const selectedProducts = [];
        $('input[name="productId[]"]:checked').each(function() {
          const item = $(this).closest('.cart-item');
          selectedProducts.push({
            id: $(this).val(),
            name: item.find('input[name="productName[]"]').val(),
            price: item.find('input[name="price[]"]').val(),
            quantity: item.find('input[name="quantity[]"]').val(),
            category: item.find('input[name="category[]"]').val()
          });
        });

        // Store the data in localStorage
        localStorage.setItem('selectedProducts', JSON.stringify(selectedProducts));
        
        // Redirect to submit_order.html
        window.location.href = 'submit_order.html';
      });

      // Initial total update
      updateTotal();
    });
  </script>
  
</body>
</html>
